schemaVersion: '0.3'
description: Removes port 22 ingress from 0.0.0.0/0 in the specified Security Group
assumeRole: '{{ AutomationAssumeRole }}'
parameters:
  GroupId:
    type: String
    description: (Required) The ID of the security group
  AutomationAssumeRole:
    type: String
    description: (Required) The ARN of the role that allows Automation to run commands
    default: ''
mainSteps:
  - description: Remove the SSH ingress rule from the security group
    name: removeSshIngressRule
    action: aws:executeAwsApi
    isEnd: true
    inputs:
      Service: ec2
      Api: RevokeSecurityGroupIngress
      GroupId: '{{ GroupId }}'
      IpPermissions:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          IpRanges:
            - CidrIp: 0.0.0.0/0
